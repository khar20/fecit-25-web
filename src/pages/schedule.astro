---
import Layout from "../layouts/Layout.astro";
import MovieCard from "../components/MovieCard.astro";

// todo: replace dummy data
const movies = [
    {
        title: "El Silencio del Viento",
        time: "19:00",
        venue: "Teatro Municipal",
        genre: "Documental",
        duration: 95,
        poster: "/assets/posters/el-silencio.jpg",
        date: "Oct 25",
    },
    {
        title: "Retablo",
        time: "19:00",
        venue: "Cineplanet",
        genre: "Ficción",
        duration: 101,
        poster: "/assets/posters/retablo.jpg",
        date: "Oct 25",
    },
    {
        title: "Canción sin Nombre",
        time: "20:00",
        venue: "Teatro Municipal",
        genre: "Ficción",
        duration: 97,
        poster: "/assets/posters/cancion.jpg",
        date: "Oct 26",
    },
    {
        title: "La Teta Asustada",
        time: "20:12",
        venue: "Auditorio UPAO",
        genre: "Ficción",
        duration: 100,
        poster: "/assets/posters/teta-asustada.jpg",
        date: "Oct 27",
    },
    {
        title: "Willaqpacha",
        time: "19:00",
        venue: "Cine Municipal",
        genre: "Ficción",
        duration: 86,
        poster: "/assets/posters/willaqpacha.jpg",
        date: "Oct 26",
    },
    {
        title: "Magallanes",
        time: "21:00",
        venue: "Cineplanet",
        genre: "Ficción",
        duration: 109,
        poster: "/assets/posters/magallanes.jpg",
        date: "Oct 27",
    },
];

const uniqueDates = [...new Set(movies.map((movie) => movie.date))];
---

<Layout title="Programación">
    <div class="container">
        <header class="page-header">
            <h1>Programación del Festival</h1>
            <p>
                Explora el calendario de proyecciones del Festival de Cine de
                Trujillo.
            </p>
        </header>

        <div class="filters">
            {uniqueDates.map((date, index) => (
                <button class:list={["filter-btn", { active: index === 0 }]} data-date={date}>
                    {date}
                </button>
            ))}
        </div>

        <div class="schedule-grid">
            {movies.map((movie) => (
                <div class="movie-card-wrapper" data-date={movie.date}>
                    <MovieCard {...movie} />
                </div>
            ))}
        </div>
    </div>
</Layout>

<style>
    .page-header {
        text-align: center;
        margin-bottom: 2rem;
    }
    .filters {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2.5rem;
        flex-wrap: wrap;
    }
    .filter-btn {
        background: var(--color-surface);
        color: var(--color-text);
        border: 1px solid #333;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        cursor: pointer;
    }
    .filter-btn.active {
        background: var(--color-primary);
        border-color: var(--color-primary);
    }
    .schedule-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 2rem;
    }

    .movie-card-wrapper.hidden {
        display: none;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const filterButtons = document.querySelectorAll<HTMLButtonElement>(".filter-btn");
        const movieCards = document.querySelectorAll<HTMLDivElement>(".movie-card-wrapper");

        function filterMovies(selectedDate: string | undefined) {
            movieCards.forEach((card) => {
                if (card.dataset.date === selectedDate) {
                    card.classList.remove("hidden");
                } else {
                    card.classList.add("hidden");
                }
            });
        }
        
        // find the initial active button
        const initialActiveButton = document.querySelector<HTMLButtonElement>(".filter-btn.active");
        if (initialActiveButton) {
            filterMovies(initialActiveButton.dataset.date);
        }

        filterButtons.forEach((button) => {
            button.addEventListener("click", () => {
                // update active button
                filterButtons.forEach((btn) => btn.classList.remove("active"));
                button.classList.add("active");

                // filter the movie cards
                const selectedDate = button.dataset.date;
                filterMovies(selectedDate);
            });
        });
    });
</script>